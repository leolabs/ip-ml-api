<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>HTML-Testpage</title>
    <script src="api_js_websocket.js" type="text/javascript"></script>
    <script>
        //function to call when sending text thru the socket
        function sendText(jsonString) {
            "use strict";
            if (isopen) {
                if (typeof jsonString !== "string") {
                    console.error("JS-Socket: Input has wrong type. String was expected");
                } else {
                    socket.send(jsonString);
                    console.log("JS-Socket: Text message sent | ", jsonString);
                }
            } else {
                console.log("JS-Socket: Connection not opened");
            }
        }

        //function to call when sending an image(png) thru the socket
        function sendBinary(file) {
            "use strict";
            if (isopen) {
                // debugging
                console.log("Debug: File name | ", file.name);
                console.log("Debug: File size | ", file.size);
               
                var reader = new FileReader();
                reader.onload = function () {
                    // debugging
                    console.log("Debug: File reader result | ", reader.result);
                    console.log("Debug: File reader error | ", reader.error);

                    // image transfer
                    socket.send(reader.result);
                    console.log("JS-Socket: Binary message sent | ", file.name);
                }

                // read file into buffer
                reader.readAsArrayBuffer(file);
                console.log("Debug: File reader state | ", reader.readyState);
            } else {
                console.log("JS-Socket: Connection not opened");
            }
        }

        //function to call when manually calling for a result
        function getResult() {
            "use strict";
            if (resultJSON == null) {
                console.error("JS-Socket: Error | result not set");
                return null;
            }
            //If result is set then
            if (isResultNew) {
                return resultJSON;
            } else {
                console.warn("JS-Socket: Warning | returning old result");
                return resultJSON;
            }
        }
    </script>
    <style>
        body {
            background: darkgrey;
            color: dimgray;
        }
    </style>
</head>

<body>
    <div class="controls" style="width: 720px; margin: auto;">
        <h1>client test</h1>
        <fieldset>
            <label for="text_input">Text/JSON Input</label>
            <br/>
            <br/>
            <textarea id="text_input" rows="5" cols="80" placeholder="Paste ndjson formatted text here" style="resize: vertical; background: darkgrey; border-color: dimgray;"></textarea>
            <br/>
            <br/>
            <button id="sendTextButton" type="submit" style="float: left;">Send text</button>
        </fieldset>

        <br/>
        <br/>

        <fieldset>
            <label for="file_input">Binary/picture Input</label>
            <br/>
            <br/>
            <input id="file_input" type="file">
            <br/>
            <br/>
            <button id="sendBinaryButton" type="submit" style="float: left;">Send file</button>
        </fieldset>

        <br/>
        <br/>

        <p>View browser console for (error) messages</p>

    </div>

</body>

</html>
